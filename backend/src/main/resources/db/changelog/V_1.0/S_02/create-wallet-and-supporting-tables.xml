<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                                        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.5.xsd">

    <changeSet id="Create Wallet Table" author="vkalushev">
        <preConditions>
            <not>
                <tableExists tableName="wallet"/>
            </not>
        </preConditions>

        <createTable tableName="wallet">
            <column name="id" type="UUID">
                <constraints primaryKey="true" nullable="false"/>
            </column>

            <column name="user_id" type="UUID">
                <constraints nullable="false" unique="true"/>
            </column>

            <column name="balance" type="decimal(19,4)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint
                baseTableName="wallet"
                baseColumnNames="user_id"
                constraintName="fk_wallet_user"
                referencedTableName="user"
                referencedColumnNames="id"
                onDelete="RESTRICT" />
    </changeSet>

    <changeSet id="Create Asset Table" author="vkalushev">
        <preConditions>
            <not>
                <tableExists tableName="asset"/>
            </not>
        </preConditions>

        <createTable tableName="asset">
            <column name="id" type="UUID">
                <constraints primaryKey="true" nullable="false"/>
            </column>

            <column name="wallet_id" type="UUID">
                <constraints nullable="false"/>
            </column>

            <column name="symbol" type="varchar">
                <constraints nullable="false"/>
            </column>

            <column name="amount" type="decimal(19,10)">
                <constraints nullable="false"/>
            </column>

            <column name="created" type="datetime">
                <constraints nullable="false"/>
            </column>

            <column name="updated" type="datetime">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint
                baseTableName="asset"
                baseColumnNames="wallet_id"
                constraintName="fk_asset_wallet"
                referencedTableName="wallet"
                referencedColumnNames="id"
                onDelete="RESTRICT" />
    </changeSet>

    <changeSet id="Create Transaction Table" author="vkalushev">
        <preConditions>
            <not>
                <tableExists tableName="transaction"/>
            </not>
        </preConditions>

        <createTable tableName="transaction">
            <column name="id" type="UUID">
                <constraints primaryKey="true" nullable="false"/>
            </column>

            <column name="wallet_id" type="UUID">
                <constraints nullable="false"/>
            </column>

            <column name="symbol" type="varchar">
                <constraints nullable="false"/>
            </column>

            <column name="amount" type="decimal(19,10)">
                <constraints nullable="false"/>
            </column>

            <column name="price" type="decimal(19,4)">
                <constraints nullable="false"/>
            </column>

            <column name="type" type="varchar">
                <constraints nullable="false"/>
            </column>

            <column name="created" type="datetime">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <addForeignKeyConstraint
                baseTableName="transaction"
                baseColumnNames="wallet_id"
                constraintName="fk_transaction_wallet"
                referencedTableName="wallet"
                referencedColumnNames="id"
                onDelete="RESTRICT"/>
    </changeSet>
</databaseChangeLog>